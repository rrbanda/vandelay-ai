Secrets Management During Migration

OVERVIEW

This guide explains how secrets are handled during the VMware to BareMetal
OpenShift migration. In most cases, no action is required from application
teams regarding secrets.

TYPES OF SECRETS

Secrets in OpenShift can be managed in different ways:

1. Managed Secrets (via Secrets API)
   - Centrally managed through the secrets management platform
   - Referenced by nickname in your application
   - Automatically synchronized across environments

2. Unmanaged Secrets (via Secrets API)
   - Created through Secrets API but not centrally managed
   - Also referenced by nickname
   - Synchronized based on configuration

3. Native Secrets
   - Standard Kubernetes secrets created directly in the namespace
   - Stored in etcd
   - Copied as part of namespace migration

MANAGED SECRETS

Action Required: NONE

Managed secrets require no action because:
- The same secret nicknames work on the destination cluster
- Secrets API handles synchronization
- Your application references remain valid

Verification:
- After migration, verify secrets are accessible
- Check application logs for any secret access errors

UNMANAGED SECRETS

Action Required: NONE

Unmanaged secrets also require no action:
- Same secret nicknames continue to work
- Secrets API maintains references
- No configuration changes needed

Verification:
- Confirm secret references in your deployment
- Test secret access after migration

NATIVE SECRETS

Action Required: NONE (Usually)

Native Kubernetes secrets are copied automatically:
- Platform Ops copies secrets during namespace migration
- Secret data is preserved
- Secret names remain the same

When action IS required:

1. Secrets referencing cluster-specific values:
   - If secret contains VMware cluster hostnames
   - If secret contains VMware-specific endpoints
   - These need manual update after migration

2. TLS secrets for routes:
   - If certificate needs update (see Certificate Guide)
   - Update the TLS secret with new certificate

3. Image pull secrets:
   - Usually copied automatically
   - Verify they're linked to service accounts

VERIFICATION STEPS

After migration, verify your secrets:

1. Check secrets exist:
   - List secrets in your namespace
   - Verify expected secrets are present
   - Compare with source cluster if needed

2. Check secret data:
   - Verify secret keys are present
   - Don't expose sensitive values
   - Check for any truncation or encoding issues

3. Test application access:
   - Deploy your application
   - Check logs for secret mount errors
   - Verify secret values are accessible in pods

TROUBLESHOOTING

Issue: Secret not found in destination namespace
Possible causes:
- Secret was created after Platform Ops snapshot
- Secret name is different than expected

Solution:
- Recreate the secret in the destination namespace
- Use Secrets API if it's a managed secret
- Create native secret if it's a native secret

Issue: Secret data appears corrupted
Possible causes:
- Encoding issues during copy
- Secret was modified during migration

Solution:
- Recreate the secret with correct data
- Verify base64 encoding is correct

Issue: Application can't read secret
Possible causes:
- Volume mount path changed
- Secret key name different
- Permission issues

Solution:
- Verify volume mount configuration
- Check secret key names match what application expects
- Verify service account permissions

Issue: Image pull fails with authentication error
Possible causes:
- Image pull secret not linked to service account
- Secret data outdated

Solution:
- Link pull secret to default service account
- Verify secret contains valid registry credentials

BEST PRACTICES

1. Use Secrets API when possible:
   - Centralized management
   - Automatic synchronization
   - Audit trail

2. Avoid hardcoded values:
   - Reference secrets by name
   - Don't embed secret values in code

3. Rotate secrets after migration:
   - Good security practice
   - Ensures fresh credentials on new platform

4. Document secret dependencies:
   - Know which secrets your app needs
   - Makes troubleshooting easier

5. Test in lower environments first:
   - Verify secret handling in DEV
   - Catch issues before PROD migration

SECRETS THAT NEED ATTENTION

While most secrets need no action, review these specifically:

- Database connection strings (if cluster-specific)
- API endpoints (if referencing VMware infrastructure)
- Integration credentials (may need verification)
- Monitoring/logging credentials (may need updates)

Create a checklist of your application's secrets and verify each one
during migration validation.
